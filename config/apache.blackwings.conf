<VirtualHost *>
	ServerName gamersmafia.dev
	DocumentRoot /home/slnc/workspace/gamersmafia/public

	ErrorDocument 500 /500.html
	ErrorDocument 503 /503.html

	<Directory "/home/slnc/workspace/gamersmafia/public">
		Options FollowSymLinks
		AllowOverride None
		Order allow,deny
		Allow from all
	</Directory>

	RewriteEngine On

	#Alias /_celements/ /home/httpd/websites/gamersmafia.dev/current/public/storage/_celements/
	#Alias /d/ /home/httpd/websites/gamersmafia.dev/current/public/storage/d/

	RewriteRule \.svn/.*   -   [R=404,L]
	RewriteRule ^/_celements/(.*)$         http://gamersmafia.dev/storage/_celements/$1 [L,R=301]

	# Redirigimos todos los dominios que empiecen por www.
	RewriteCond %{HTTP_HOST}   !^gamersmafia\.dev [NC]
	RewriteRule ^/miembros(.*)         http://gamersmafia.dev/miembros$1 [L,R=301]

	RewriteCond %{HTTP_HOST}   ^www\.(.+) [NC]
	RewriteRule ^(.*)          http://%1$1 [L,R=301]

	RewriteCond %{HTTP_HOST}   !^gamersmafia\.dev [NC]
	RewriteRule ^blogs(.*)     http://gamersmafia.dev/blogs$1 [L,R=301]

	RewriteCond %{HTTP_HOST}   ^ut3\.es [NC]
	RewriteRule ^(.*)          http://ut3.gamersmafia.dev$1 [L,R=301]


	# RewriteCond %{HTTP_HOST}   ^\.(com|net|org|es|info) [NC]
	#  RewriteRule ^(.*)         http://%1.gamersmafia.dev$1 [L,R=301]

	# RewriteMap domains txt:/home/httpd/websites/gamersmafia.dev/current/config/domains_to_codes.txt

	#  RewriteCond %{HTTP_HOST}   ^(4coders\.net|4unrealers\.dev|4quakers\.dev|4mohers\.dev|dowforever\.dev|4americasarmy\.dev|4doomers\.net|4guildwars\.dev|4ragnarok\.dev|4soldiers\.net|nwnspain\.dev|4warcraft\.dev|battlefieldspain\.dev|bf1942spain\.dev|defuseit\.dev|sc2-esp\.net|quakereligion\.dev) [NC]
	#RewriteRule ^(.*)         http://${domains:%1}.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^d3-esp\.dev
	RewriteRule ^(.*)         http://diablo.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^4coders\.net
	RewriteRule ^(.*)         http://cod.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^4quakers\.dev
	RewriteRule ^(.*)         http://quake.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^4unrealers\.dev
	RewriteRule ^(.*)         http://unreal.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^4mohers\.dev
	RewriteRule ^(.*)         http://moh.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^dowforever\.dev
	RewriteRule ^(.*)         http://dow.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^4americasarmy\.dev
	RewriteRule ^(.*)         http://aa.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^4doomers\.net
	RewriteRule ^(.*)         http://d3.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^4ragnarok\.dev
	RewriteRule ^(.*)         http://ro.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^4soldiers\.net
	RewriteRule ^(.*)         http://sof2.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^4warcraft\.dev
	RewriteRule ^(.*)         http://wow.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^battlefieldspain\.dev
	RewriteRule ^(.*)         http://bf2.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^bf1942spain\.dev
	RewriteRule ^(.*)         http://bf2.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^defuseit\.dev
	RewriteRule ^(.*)         http://cs.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^sc2-esp\.net
	RewriteRule ^(.*)         http://sc2.gamersmafia.dev$1 [L,R=301]

	RewriteCond %{HTTP_HOST}  ^quakereligion\.dev
	RewriteRule ^(.*)         http://quake.gamersmafia.dev$1 [L,R=301]


	RewriteCond %{HTTP_HOST}   ^gamersmafia\.(net|org|es|info) [NC,OR]
	RewriteCond %{HTTP_HOST}   ^gamersblogs\.net [NC]
	RewriteRule ^(.*)         http://gamersmafia.dev$1 [L,R=301]

	RewriteRule ^noticias_eventos(.*)         /coverages%1 [L,R=301]
	RewriteRule ^/offtopics(.*)         http://bazar.gamersmafia.dev/noticias [L,R=301]

	RewriteRule ^/d/(.+)$          /storage/d/$1 [L,R=302]

	#RewriteCond %{REQUEST_FILENAME} /storage/download/(.*)$ [NC]
	#RewriteRule ^.*$          /descargas [L,R=301]


	RewriteCond %{REQUEST_FILENAME} /storage/downloads/(.*)$ [NC]
	RewriteRule ^.*$          /descargas [L,R=301]

	<Directory "/home/slnc/workspace/gamersmafia/public/storage/downloads">
		ForceType application/octet-stream 
		Header set Content-Disposition attachment
	</Directory>

	RewriteCond %{REQUEST_FILENAME} /descargas/download/([0-9]+)$ [NC]
	RewriteCond %{HTTP_REFERER} !^$ 
	RewriteCond %{HTTP_REFERER} !gamersmafia\.dev [NC] 
	RewriteRule ^/descargas/download/([0-9]+)$          /descargas/show/$1 [L,R=301]


	RewriteRule ^(.*\.)[0-9a-zA-Z]{7}\.(css|js|gif|png|jpg)$	/$1$2	[L]
	RewriteRule ^(.*\.)[0-9]+\.(css|js|gif|png|jpg)$	/$1$2	[L]

	# shortcut 404 of assets 
	# NO ACTIVAR
	#RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
	#RewriteRule ^(.*)(css|js)$ / [R=404,L]

	# redirect urls containing other hosts
	RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
	RewriteRule ^(.*)/(www\.)*([a-z0-9]+)\.(com|net|org|es+)$ http://$2$3.$4/ [R=301,L]

	# Redirect all non-static requests to cluster
	RewriteCond %{DOCUMENT_ROOT}/%{REQUEST_FILENAME} !-f
	RewriteRule ^/(.*)$ balancer://mongrel_cluster%{REQUEST_URI} [P,QSA,L]



	AddDefaultCharset UTF-8

	# Deflate
	AddOutputFilterByType DEFLATE text/html text/plain text/css text/xml application/xml application/xhtml+xml text/javascript application/x-javascript application/javascript
	BrowserMatch ^Mozilla/4 gzip-only-text/html
	BrowserMatch ^Mozilla/4.0[678] no-gzip
	BrowserMatch \bMSIE !no-gzip !gzip-only-text/html

	LogFormat    "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" gm
	CustomLog    /dev/null gm
	# CustomLog    "|/usr/local/hosting/bin/rotatelogs /var/log/apache/gamersmafia.dev/main_access-%Y%m%d.log 86400" gm
	#LogLevel notice
	ErrorLog "|/usr/local/hosting/bin/rotatelogs /var/log/apache/gamersmafia.dev/error-%Y%m%d.log 86400"

	<Proxy balancer://mongrel_cluster>
		BalancerMember http://127.0.0.1:3000 retry=5
		ProxySet maxattempts=10000
	</Proxy>

	ExpiresActive On
	expiresbytype image/gif A9592000
	expiresbytype image/jpeg A9592000
	expiresbytype image/jpg A9592000
	expiresbytype image/png A9592000
	expiresbytype image/x-icon A9592000
	expiresbytype text/css A9592000
	expiresbytype text/javascript A9592000
	expiresbytype application/javascript A9592000
	expiresbytype application/x-shockwave-flash A9592000
	
	<FilesMatch "\.(gif|jpe?g|png|ico|css|js|swf)$">
		Header set Cache-Control "public"
	</FilesMatch>

	<FilesMatch "channels">
		ExpiresDefault "access plus 10 years"
	</FilesMatch>
</VirtualHost>
